flowchart TD
    A["🤖 Cloud Run Job<br/>(Data Generator)"] -->|"Pub/Sub Messages"| B[("☁️ Pub/Sub Topic<br/>sensor-readings")]
    
    C["⏰ Cloud Scheduler"] -->|"Triggers"| D["🔄 Cloud Workflows<br/>(Pipeline Orchestration)"]
    
    B -->|"Pull Messages"| D
    D --> D1["📥 Ingest Function<br/>(Pub/Sub → BigQuery)"]
    D1 --> E[("🏢 BigQuery<br/>Dataset: iot_pipeline")]
    
    D --> D2["🔄 dbt Cloud Job<br/>(Transform Models)"]
    D2 --> E
    
    E --> E1["📊 raw_sensor_readings<br/>(Raw Data)"]
    E --> E2["📈 fact_readings<br/>(Hourly Aggregates)"]
    E --> E3["🏷️ dim_sensors<br/>(Sensor Dimension)"]
    
    E --> F["📱 Cloud Run App<br/>(Streamlit Dashboard)"]
    F --> F1["📊 Interactive Charts"]
    F --> F2["🚨 Real-time Anomalies"]
    F --> F3["📋 Live Status"]
    
    G["🔐 Cloud IAM"] -.->|"Manages Access"| H["🔑 Service Accounts"]
    I["📊 Cloud Monitoring"] -.->|"Tracks Costs"| J["💰 Budget Alerts"]
    
    K["🚀 GitHub Actions"] -.->|"CI/CD Deploy"| F
    K -.-> A
    
    style A fill:#e3f2fd
    style B fill:#fff3e0
    style D fill:#f3e5f5
    style E fill:#e8f5e8
    style F fill:#fff8e1
    style G fill:#fce4ec
